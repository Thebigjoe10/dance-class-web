<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>My Classes - Dance Class</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Yantramanav:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">

    <style>
        .page-header {
            background: linear-gradient(135deg, var(--bs-primary) 0%, var(--bs-secondary) 100%);
            padding: 60px 0;
            color: white;
            text-align: center;
        }

        .page-header h1 {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .page-header p {
            font-size: 18px;
            opacity: 0.95;
        }

        .page-container {
            padding: 60px 0;
            background: #f8f9fa;
        }

        .filter-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .filter-card h5 {
            font-size: 18px;
            font-weight: 700;
            color: var(--bs-primary);
            margin-bottom: 20px;
        }

        .class-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            transition: all 0.3s;
        }

        .class-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }

        .class-card .class-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .class-card .class-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .class-card .class-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .class-card .info-item {
            display: flex;
            align-items: center;
            color: #666;
            font-size: 15px;
        }

        .class-card .info-item i {
            color: var(--bs-primary);
            margin-right: 10px;
            width: 20px;
        }

        .class-card .badge {
            font-size: 13px;
            padding: 8px 15px;
            font-weight: 600;
        }

        .class-card .class-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .attendance-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .attendance-section h6 {
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .attendance-stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .attendance-stat {
            text-align: center;
        }

        .attendance-stat .number {
            font-size: 28px;
            font-weight: 700;
            color: var(--bs-primary);
        }

        .attendance-stat .label {
            font-size: 13px;
            color: #666;
        }

        .schedule-view {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }

        .schedule-view h4 {
            font-size: 22px;
            font-weight: 700;
            color: var(--bs-primary);
            margin-bottom: 25px;
        }

        .schedule-day {
            border-left: 4px solid var(--bs-primary);
            padding: 15px 20px;
            margin-bottom: 15px;
            background: #f8f9fa;
            border-radius: 0 10px 10px 0;
        }

        .schedule-day .day-name {
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .schedule-day .class-time {
            color: #666;
            font-size: 14px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 25px;
            opacity: 0.3;
        }

        .empty-state h4 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .empty-state p {
            font-size: 16px;
            margin-bottom: 25px;
        }

        .loading-spinner {
            text-align: center;
            padding: 60px;
        }

        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 32px;
            }

            .class-card {
                padding: 20px;
            }

            .class-card .class-info {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <!-- Spinner Start -->
    <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
    <!-- Spinner End -->

    <!-- Topbar Start -->
    <div class="container-fluid bg-secondary px-5 d-none d-lg-block">
        <div class="row gx-0 align-items-center" style="height: 45px;">
            <div class="col-lg-8 text-center text-lg-start mb-lg-0">
                <div class="d-flex flex-wrap">
                    <a href="#" class="text-light me-4"><i class="fas fa-map-marker-alt text-primary me-2"></i>Find A Location</a>
                    <a href="#" class="text-light me-4"><i class="fas fa-phone-alt text-primary me-2"></i>+01234567890</a>
                    <a href="#" class="text-light me-0"><i class="fas fa-envelope text-primary me-2"></i>Example@gmail.com</a>
                </div>
            </div>
            <div class="col-lg-4 text-center text-lg-end">
                <div class="d-flex justify-content-end">
                    <div class="border-end border-start py-1">
                        <a href="#" class="btn text-primary"><i class="fab fa-facebook-f"></i></a>
                    </div>
                    <div class="border-end py-1">
                        <a href="#" class="btn text-primary"><i class="fab fa-twitter"></i></a>
                    </div>
                    <div class="border-end py-1">
                        <a href="#" class="btn text-primary"><i class="fab fa-instagram"></i></a>
                    </div>
                    <div class="border-end py-1">
                        <a href="#" class="btn text-primary"><i class="fab fa-tiktok"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Topbar End -->

    <!-- Navbar Start -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white px-4 px-lg-5 py-3 py-lg-0 sticky-top">
        <a href="index.html" class="navbar-brand p-0">
            <h1 class="text-primary m-0"><i class="fas fa-biohazard me-3"></i>SOP</h1>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
            <span class="fa fa-bars"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav ms-auto py-0">
                <a href="index.html" class="nav-item nav-link">Home</a>
                <a href="student-dashboard.html" class="nav-item nav-link">Dashboard</a>
                <a href="my-classes.html" class="nav-item nav-link active">My Classes</a>
                <a href="my-tickets.html" class="nav-item nav-link">My Tickets</a>
                <a href="classes.html" class="nav-item nav-link">Browse Classes</a>
                <a href="event.html" class="nav-item nav-link">Events</a>
            </div>
            <button class="btn btn-primary rounded-pill py-2 px-4 ms-lg-4 logout-btn">
                <i class="fas fa-sign-out-alt me-2"></i>Logout
            </button>
        </div>
    </nav>
    <!-- Navbar End -->

    <!-- Page Header Start -->
    <div class="page-header">
        <div class="container">
            <h1>My Classes</h1>
            <p>View and manage your enrolled dance classes</p>
        </div>
    </div>
    <!-- Page Header End -->

    <!-- Page Content Start -->
    <div class="container-fluid page-container">
        <div class="container">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-lg-3">
                    <div class="filter-card">
                        <h5><i class="fas fa-filter me-2"></i>View Options</h5>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary active" onclick="showListView()">
                                <i class="fas fa-list me-2"></i>List View
                            </button>
                            <button class="btn btn-outline-primary" onclick="showScheduleView()">
                                <i class="fas fa-calendar me-2"></i>Schedule View
                            </button>
                        </div>
                    </div>

                    <div class="filter-card">
                        <h5><i class="fas fa-info-circle me-2"></i>Quick Stats</h5>
                        <div class="mb-3">
                            <strong>Total Classes:</strong>
                            <div class="h4 text-primary mb-0" id="totalClassesCount">0</div>
                        </div>
                        <div class="mb-3">
                            <strong>This Week:</strong>
                            <div class="h4 text-success mb-0" id="weekClassesCount">0</div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-lg-9">
                    <!-- List View -->
                    <div id="listView">
                        <div id="classesList">
                            <div class="loading-spinner">
                                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-3">Loading your classes...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Schedule View -->
                    <div id="scheduleView" style="display: none;">
                        <div class="schedule-view">
                            <h4><i class="fas fa-calendar-alt me-2"></i>Weekly Schedule</h4>
                            <div id="weeklySchedule">
                                <div class="loading-spinner">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Page Content End -->

    <!-- Unenroll Modal -->
    <div class="modal fade" id="unenrollModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Unenrollment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to unenroll from this class?</p>
                    <p class="text-muted"><strong id="unenrollClassName"></strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmUnenroll">Unenroll</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Start -->
    <div class="container-fluid footer py-5 wow fadeIn" data-wow-delay="0.2s">
        <div class="container py-5">
            <div class="row g-5">
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <h4 class="text-white mb-4"><i class="fas fa-biohazard me-3"></i>SOP Dance</h4>
                        <p>Join our vibrant dance community and discover your passion for movement.</p>
                        <div class="d-flex align-items-center">
                            <a class="btn-square btn btn-primary text-white rounded-circle me-2" href="#"><i class="fab fa-facebook-f"></i></a>
                            <a class="btn-square btn btn-primary text-white rounded-circle me-2" href="#"><i class="fab fa-twitter"></i></a>
                            <a class="btn-square btn btn-primary text-white rounded-circle me-2" href="#"><i class="fab fa-instagram"></i></a>
                            <a class="btn-square btn btn-primary text-white rounded-circle me-0" href="#"><i class="fab fa-tiktok"></i></a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <h4 class="mb-4 text-white">Quick Links</h4>
                        <a href="about.html"><i class="fas fa-angle-right me-2"></i> About</a>
                        <a href="classes.html"><i class="fas fa-angle-right me-2"></i> Classes</a>
                        <a href="event.html"><i class="fas fa-angle-right me-2"></i> Events</a>
                        <a href="contact.html"><i class="fas fa-angle-right me-2"></i> Contact</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <h4 class="mb-4 text-white">Contact Info</h4>
                        <a href="#"><i class="fa fa-map-marker-alt me-2"></i> 123 Street, New York, USA</a>
                        <a href="#"><i class="fas fa-envelope me-2"></i> info@example.com</a>
                        <a href="#"><i class="fas fa-phone me-2"></i> +012 345 67890</a>
                    </div>
                </div>
                <div class="col-md-6 col-lg-6 col-xl-3">
                    <div class="footer-item d-flex flex-column">
                        <h4 class="mb-4 text-white">Opening Hours</h4>
                        <div class="mb-3">
                            <h6 class="text-muted mb-0">Mon - Friday:</h6>
                            <p class="text-white mb-0">09.00 am to 07.00 pm</p>
                        </div>
                        <div class="mb-3">
                            <h6 class="text-muted mb-0">Saturday:</h6>
                            <p class="text-white mb-0">10.00 am to 05.00 pm</p>
                        </div>
                        <div class="mb-3">
                            <h6 class="text-muted mb-0">Vacation:</h6>
                            <p class="text-white mb-0">All Sunday is our vacation</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    <!-- Copyright Start -->
    <div class="container-fluid copyright py-4">
        <div class="container">
            <div class="row g-4 align-items-center">
                <div class="col-md-6 text-center text-md-start mb-md-0">
                    <span class="text-white"><a href="#"><i class="fas fa-copyright text-light me-2"></i>SOP Dance</a>, All right reserved.</span>
                </div>
                <div class="col-md-6 text-center text-md-end text-white">
                    Designed by <a class="border-bottom" href="https://htmlcodex.com">HTML Codex</a>
                </div>
            </div>
        </div>
    </div>
    <!-- Copyright End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-primary btn-lg-square back-to-top"><i class="fa fa-arrow-up"></i></a>

    <!-- JavaScript Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>

    <!-- API & Auth Scripts -->
    <script src="js/api-config.js"></script>
    <script src="js/auth.js"></script>

    <!-- My Classes Script -->
    <script>
        // Require student authentication
        requireStudent();

        let enrolledClasses = [];
        let selectedClassId = null;

        // Load classes
        async function loadClasses() {
            try {
                const response = await apiGet(`${API_BASE_URL}/classes/student/my-classes`);
                enrolledClasses = response.data || response || [];

                // Update counts
                document.getElementById('totalClassesCount').textContent = enrolledClasses.length;
                document.getElementById('weekClassesCount').textContent = enrolledClasses.length;

                // Display classes
                displayClasses();
                displaySchedule();

            } catch (error) {
                console.error('Error loading classes:', error);
                document.getElementById('classesList').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <h4>Error Loading Classes</h4>
                        <p>Unable to load your classes. Please try again later.</p>
                        <button class="btn btn-primary" onclick="loadClasses()">Retry</button>
                    </div>
                `;
            }
        }

        // Display classes
        function displayClasses() {
            const container = document.getElementById('classesList');

            if (enrolledClasses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-graduation-cap"></i>
                        <h4>No Classes Yet</h4>
                        <p>You haven't enrolled in any classes. Browse our available classes to get started!</p>
                        <a href="classes.html" class="btn btn-primary btn-lg">
                            <i class="fas fa-search me-2"></i>Browse Classes
                        </a>
                    </div>
                `;
                return;
            }

            container.innerHTML = enrolledClasses.map(cls => `
                <div class="class-card">
                    <div class="class-header">
                        <div>
                            <div class="class-title">${cls.title || cls.name}</div>
                            <p class="text-muted mb-0">${cls.description || 'An amazing dance class experience'}</p>
                        </div>
                        <span class="badge bg-primary">${cls.level || 'All Levels'}</span>
                    </div>

                    <div class="class-info">
                        <div class="info-item">
                            <i class="fas fa-user"></i>
                            <span><strong>Instructor:</strong> ${cls.instructor || 'TBA'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-calendar-day"></i>
                            <span><strong>Day:</strong> ${cls.day || 'TBA'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-clock"></i>
                            <span><strong>Time:</strong> ${cls.time || 'TBA'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-hourglass-half"></i>
                            <span><strong>Duration:</strong> ${cls.duration || '60 min'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span><strong>Location:</strong> ${cls.location || 'Main Studio'}</span>
                        </div>
                        <div class="info-item">
                            <i class="fas fa-users"></i>
                            <span><strong>Capacity:</strong> ${cls.currentEnrollment || 0}/${cls.maxCapacity || 'N/A'}</span>
                        </div>
                    </div>

                    ${cls.attendance ? `
                        <div class="attendance-section">
                            <h6><i class="fas fa-chart-line me-2"></i>Attendance Record</h6>
                            <div class="attendance-stats">
                                <div class="attendance-stat">
                                    <div class="number">${cls.attendance.total || 0}</div>
                                    <div class="label">Total Sessions</div>
                                </div>
                                <div class="attendance-stat">
                                    <div class="number">${cls.attendance.attended || 0}</div>
                                    <div class="label">Attended</div>
                                </div>
                                <div class="attendance-stat">
                                    <div class="number">${cls.attendance.percentage || 0}%</div>
                                    <div class="label">Attendance Rate</div>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary" onclick="viewClassDetails('${cls.id || cls._id}')">
                            <i class="fas fa-info-circle me-2"></i>View Details
                        </button>
                        <button class="btn btn-outline-danger" onclick="showUnenrollModal('${cls.id || cls._id}', '${cls.title || cls.name}')">
                            <i class="fas fa-times me-2"></i>Unenroll
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Display schedule view
        function displaySchedule() {
            const container = document.getElementById('weeklySchedule');

            if (enrolledClasses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar"></i>
                        <h4>No Schedule Available</h4>
                        <p>Enroll in classes to see your weekly schedule</p>
                    </div>
                `;
                return;
            }

            // Group classes by day
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const schedule = {};

            enrolledClasses.forEach(cls => {
                const day = cls.day || 'Unscheduled';
                if (!schedule[day]) {
                    schedule[day] = [];
                }
                schedule[day].push(cls);
            });

            container.innerHTML = days.map(day => {
                const classes = schedule[day] || [];
                if (classes.length === 0) return '';

                return `
                    <div class="schedule-day">
                        <div class="day-name">${day}</div>
                        ${classes.map(cls => `
                            <div class="class-time">
                                <i class="fas fa-clock me-2"></i>${cls.time || 'TBA'} - ${cls.title || cls.name}
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('') || '<p class="text-muted">No scheduled classes</p>';
        }

        // Show/hide views
        function showListView() {
            document.getElementById('listView').style.display = 'block';
            document.getElementById('scheduleView').style.display = 'none';
        }

        function showScheduleView() {
            document.getElementById('listView').style.display = 'none';
            document.getElementById('scheduleView').style.display = 'block';
        }

        // View class details
        function viewClassDetails(classId) {
            alert('Detailed class view will be implemented. Class ID: ' + classId);
        }

        // Show unenroll modal
        function showUnenrollModal(classId, className) {
            selectedClassId = classId;
            document.getElementById('unenrollClassName').textContent = className;
            const modal = new bootstrap.Modal(document.getElementById('unenrollModal'));
            modal.show();
        }

        // Confirm unenroll
        document.getElementById('confirmUnenroll').addEventListener('click', async function() {
            if (!selectedClassId) return;

            try {
                const btn = this;
                setButtonLoading(btn, true);

                // Call API to unenroll
                await apiDelete(`${API_BASE_URL}/classes/${selectedClassId}/unregister`);

                // Success
                alert('Successfully unenrolled from class');

                // Hide modal
                bootstrap.Modal.getInstance(document.getElementById('unenrollModal')).hide();

                // Reload classes
                await loadClasses();

            } catch (error) {
                console.error('Error unenrolling:', error);
                alert('Failed to unenroll. Please try again.');
            } finally {
                setButtonLoading(this, false);
            }
        });

        // Load classes on page load
        loadClasses();
    </script>
</body>

</html>
